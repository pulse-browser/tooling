import { existsSync, writeFileSync } from 'fs'
import { resolve } from 'path'
import { cwd } from 'process'
import { xulElements } from 'xul-elements'

let jsxFileContents = `// This file is autogenerated. If you need to modify it, change scripts/createElementTypes.ts instead.

// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.

import { UniversalXULProps } from './xul.d.ts'

type XULElementBuilder<T> = T &
  UniversalXULProps

`

for (const element of xulElements) {
  const definitionType = resolve(cwd(), 'src/elements', `${element}.d.ts`)

  jsxFileContents += `import { ${element}Props } from './elements/${element}.d.ts'\n`

  if (existsSync(definitionType)) {
    continue
  }

  writeFileSync(
    definitionType,
    `// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this
// file, You can obtain one at http://mozilla.org/MPL/2.0/.

export interface ${element}Props {}\n`
  )
}

jsxFileContents += `

declare global {
    namespace JSX {
        interface IntrinsicElements {
            ${xulElements
              .map(
                (element) => `${element}: XULElementBuilder<${element}Props>;`
              )
              .join('\n            ')}
        }
    }
}

`

writeFileSync(resolve(cwd(), 'src/jsx.d.ts'), jsxFileContents)
